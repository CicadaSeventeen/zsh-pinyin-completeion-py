import socket
import os
import sys
import pickle
#DEBUG = 1
def main(target,path='.'):
# 获得合适的变量来建立socket
    XDG_RUNTIME_DIR = os.environ.get("XDG_RUNTIME_DIR")
    SHELL_PID = os.getppid()
    if 'DEBUG' in globals():
        socket_path = '/tmp/test'
    else:
        socket_path = XDG_RUNTIME_DIR + '/' + str(SHELL_PID)
# 检查socket文件是否存在
    if not os.path.exists(socket_path):
        sys.stderr.write("Socket Error")
        exit(1)
# 创建Unix Domain Socket客户端
    client = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
    client.connect(socket_path)  # 连接到socket文件
    client_data_list = [target,path,dict(os.environ)]
    client_data_pickle = pickle.dumps(client_data_list)
    client.send(client_data_pickle)
    # 接收服务器回复
    server_data = client.recv(65536).decode()
    client.close()
    return server_data

if __name__ == "__main__":
    main(target='',path='.')
